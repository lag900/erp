import{u as e,o as s,a,k as t,m as r,p as l,w as d,b as i,c as o,e as m,d as u,F as n,z as p,n as c,t as b,s as f,x as _,l as x,y,g,A as h}from"./vendor-DGI0tb4d.js";import{_ as v}from"./AuthenticatedLayout-odOuIOG-.js";import{_ as w}from"./TextInput-7Tb4wL4u.js";import{P as j}from"./PrimaryButton-CXxvsKbC.js";import{_ as k}from"./InputLabel-ttg1gjZN.js";import{G as U}from"./GlobalCheckbox-BSagvGQB.js";import"./utils-B98O4e5m.js";/* empty css                                                              */import"./_plugin-vue_export-helper-BCo6x5W8.js";import"./DangerButton-Bzsvvehx.js";import"./SecondaryButton-DsdD6xme.js";const B={class:"flex flex-wrap items-center justify-between gap-3"},C={class:"text-xl font-semibold leading-tight text-gray-800"},L={class:"py-6"},M={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},S={class:"mb-4 flex flex-wrap items-center justify-between gap-3"},V={class:"overflow-hidden rounded bg-white shadow"},q={class:"min-w-full divide-y divide-gray-200 text-sm"},A={class:"divide-y divide-gray-200"},D={class:"px-4 py-3"},$={class:"flex items-center gap-3"},F={class:"text-gray-800"},G={class:"text-xs text-gray-500"},I={class:"px-4 py-3"},O={class:"max-w-xs"},P=["id","onUpdate:modelValue","disabled"],R=["value"],T={class:"px-4 py-3"},z={class:"flex items-center gap-2 text-sm text-gray-600"},E={__name:"Members",props:{department:{type:Object,required:!0},users:{type:Array,required:!0},roles:{type:Array,required:!0},memberships:{type:Object,required:!0}},setup(E){const H=E,J=y(""),K=h(),N=g(()=>K.props.auth?.permissions??[]),Q=e=>N.value.includes(e),W=e({members:H.users.map(e=>{const s=H.memberships[e.id];return{user_id:e.id,is_member:Boolean(s),role_id:s?.role_id??H.roles[0]?.id??null,is_default:s?.is_default??!1}})}),X=g(()=>H.users.reduce((e,s)=>(e[s.id]=s,e),{})),Y=g(()=>{const e=J.value.trim().toLowerCase();return e?W.members.filter(s=>{const a=X.value[s.user_id];return!!a&&(a.name.toLowerCase().includes(e)||a.email.toLowerCase().includes(e))}):W.members}),Z=()=>{const e=W.members.filter(e=>e.is_member).map(e=>({user_id:e.user_id,role_id:e.role_id,is_default:e.is_default}));W.transform(()=>({members:e})).put(route("departments.members.update",H.department.id),{preserveScroll:!0,onFinish:()=>W.transform(e=>e)})};return(e,y)=>(s(),a(n,null,[t(r(l),{title:`Members - ${E.department.name}`},null,8,["title"]),t(v,null,{header:d(()=>[i("div",B,[i("h2",C," Members - "+b(E.department.name),1),t(r(x),{href:e.route("departments.index"),class:"rounded border border-gray-300 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50"},{default:d(()=>[...y[1]||(y[1]=[m(" Back to Departments ",-1)])]),_:1},8,["href"])])]),default:d(()=>[i("div",L,[i("div",M,[i("div",S,[t(w,{modelValue:J.value,"onUpdate:modelValue":y[0]||(y[0]=e=>J.value=e),type:"text",class:"mt-1 block w-full sm:max-w-sm",placeholder:"Search users..."},null,8,["modelValue"]),Q("department-assign-users")?(s(),o(j,{key:0,disabled:r(W).processing,onClick:Z},{default:d(()=>[...y[2]||(y[2]=[m(" Save Members ",-1)])]),_:1},8,["disabled"])):u("",!0)]),i("div",V,[i("table",q,[y[5]||(y[5]=i("thead",{class:"bg-gray-50 text-left text-gray-600"},[i("tr",null,[i("th",{class:"px-4 py-3 font-medium"},"Member"),i("th",{class:"px-4 py-3 font-medium"},"Role"),i("th",{class:"px-4 py-3 font-medium"},"Default")])],-1)),i("tbody",A,[(s(!0),a(n,null,p(Y.value,e=>(s(),a("tr",{key:e.user_id,class:c(e.is_member?"bg-white":"bg-gray-50")},[i("td",D,[i("div",$,[t(U,{checked:e.is_member,id:"member-"+e.user_id,"onUpdate:checked":s=>(e=>{e.is_member=!e.is_member,e.is_member||(e.is_default=!1)})(e)},null,8,["checked","id","onUpdate:checked"]),i("div",null,[i("p",F,b(X.value[e.user_id]?.name),1),i("p",G,b(X.value[e.user_id]?.email),1)])])]),i("td",I,[i("div",O,[t(k,{for:`role-${e.user_id}`,value:"Role",class:"sr-only"},null,8,["for"]),f(i("select",{id:`role-${e.user_id}`,"onUpdate:modelValue":s=>e.role_id=s,disabled:!e.is_member||!Q("department-assign-users"),class:"w-full rounded border-gray-300 text-sm shadow-sm focus:border-indigo-500 focus:ring-indigo-500 disabled:bg-gray-100"},[y[3]||(y[3]=i("option",{value:"",disabled:""},"Select role",-1)),(s(!0),a(n,null,p(E.roles,e=>(s(),a("option",{key:e.id,value:e.id},b(e.name),9,R))),128))],8,P),[[_,e.role_id]])])]),i("td",T,[i("label",z,[t(U,{checked:e.is_default,"onUpdate:checked":s=>e.is_default=s,id:"default-"+e.user_id},null,8,["checked","onUpdate:checked","id"]),y[4]||(y[4]=m(" Default for this user ",-1))])])],2))),128))])])])])])]),_:1})],64))}};export{E as default};
