import{u as R,o as a,c as d,a as n,b as l,h as D,w as u,d as s,e as F,t as c,F as v,m as w,k as _,n as T,i as g,_ as C,j as B,p as f,r as H,q as I}from"./app-BX5kK8gL.js";import{_ as q}from"./AuthenticatedLayout-WTG0r7J_.js";import{_ as L}from"./TextInput-D8M23_PG.js";import{_ as K}from"./InputLabel-BWg1fGz9.js";import{_ as V}from"./InputError-C8hi-McE.js";import{G as y}from"./GlobalCheckbox-Bkg5O3-I.js";/* empty css                                                              */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DangerButton-Doqh3QbT.js";import"./SecondaryButton-CW323Hov.js";const O={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},W={class:"mt-1 text-sm text-gray-500"},J={class:"font-black text-primary"},Q={class:"flex flex-wrap gap-2"},X={class:"py-10"},Y={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},Z={class:"overflow-hidden rounded-2xl border border-gray-100 bg-white p-8 shadow-premium"},ee={class:"max-w-md"},se={class:"space-y-6"},te={class:"flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between px-2"},re={class:"flex items-center gap-6 bg-white px-6 py-3 rounded-2xl border border-gray-100 shadow-soft"},oe={class:"flex items-center gap-3"},ie={class:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter"},le={class:"relative w-full sm:w-80"},ne={class:"grid gap-6 md:grid-cols-2 lg:grid-cols-3"},ae={class:"flex items-center justify-between border-b border-gray-100 bg-gray-50/50 px-6 py-4"},de={class:"flex items-center gap-3"},ce={class:"text-xs font-black uppercase tracking-widest text-gray-900"},ue={class:"text-[9px] font-bold uppercase text-gray-400"},me={class:"flex-1 space-y-1 p-4"},pe=["for"],ge={class:"block text-sm font-bold text-gray-700 group-hover:text-primary transition-colors"},fe={class:"block text-[8px] font-black uppercase text-gray-300 tracking-widest leading-none"},he={key:0,class:"text-[10px] font-black uppercase text-primary/40 tracking-tighter"},xe={class:"px-6 py-3 border-t border-gray-50 flex items-center justify-between text-[10px] font-bold text-gray-400"},ve={class:"flex gap-0.5"},ye={key:0,class:"mt-12 bg-gray-50/50 rounded-3xl p-8 border border-dashed border-gray-200"},be={class:"flex items-center gap-3 mb-6 px-2"},ke={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4"},we=["for"],_e={class:"text-xs font-bold text-gray-600 tracking-tight"},Ce={class:"sticky bottom-8 flex items-center justify-between rounded-2xl border border-gray-200 bg-white shadow-2xl p-6 ring-1 ring-black/5"},je={class:"flex items-center gap-4 text-sm font-bold text-gray-500"},Me={class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gray-100 text-gray-900 border border-gray-200"},Pe={class:"flex gap-3"},Ne={__name:"Edit",props:{role:Object,groups:Array,ungrouped:Array},setup(b){const m=b,U=()=>{r.put(route("roles.update",m.role.id),{onSuccess:()=>{window.showToast&&window.showToast("success","Security matrix updated successfully.")}})},k=H(""),$=I(),z=f(()=>$.props.auth?.permissions??[]),j=t=>z.value.includes(t),r=R({name:m.role.name,permission_ids:m.role.permission_ids||[]}),G=f(()=>{const t=k.value.trim().toLowerCase();return m.groups.map(e=>{const o=e.permissions.filter(i=>i.name.toLowerCase().includes(t)||i.description&&i.description.toLowerCase().includes(t));return{...e,matchedPerms:o}}).filter(e=>e.matchedPerms.length>0)}),h=f(()=>{const t=k.value.trim().toLowerCase();return m.ungrouped.filter(e=>e.name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t))}),M=t=>{const e=t.map(i=>i.id);if(e.every(i=>r.permission_ids.includes(i)))r.permission_ids=r.permission_ids.filter(i=>!e.includes(i));else{const i=e.filter(x=>!r.permission_ids.includes(x));r.permission_ids=[...r.permission_ids,...i]}},P=t=>t.length>0&&t.every(e=>r.permission_ids.includes(e.id)),A=t=>{const e=t.filter(o=>r.permission_ids.includes(o.id)).length;return e>0&&e<t.length},p=f(()=>{const t=[];return m.groups.forEach(e=>t.push(...e.permissions)),t.push(...m.ungrouped),t}),S=f(()=>p.value.length>0&&p.value.every(t=>r.permission_ids.includes(t.id))),E=f(()=>{const t=p.value.filter(e=>r.permission_ids.includes(e.id)).length;return t>0&&t<p.value.length}),N=()=>{S.value?r.permission_ids=[]:r.permission_ids=p.value.map(t=>t.id)};return(t,e)=>(a(),d(v,null,[n(l(D),{title:`Secure Matrix: ${l(r).name}`},null,8,["title"]),n(q,null,{header:u(()=>[s("div",O,[s("div",null,[e[9]||(e[9]=s("h2",{class:"text-2xl font-bold leading-tight text-gray-800"}," Access Control Matrix ",-1)),s("p",W,[e[7]||(e[7]=g("Fine-tune the operational perimeter for ",-1)),s("span",J,c(b.role.name),1),e[8]||(e[8]=g(".",-1))])]),s("div",Q,[n(C,{href:t.route("roles.index"),variant:"secondary"},{icon:u(()=>[...e[10]||(e[10]=[s("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),default:u(()=>[e[11]||(e[11]=g(" Return to Registry ",-1))]),_:1},8,["href"]),j("role-delete")&&b.role.name!=="SuperAdmin"?(a(),B(C,{key:0,variant:"danger",onClick:e[0]||(e[0]=()=>{t.window.confirm("Wipe this role and its access keys?")&&t.$inertia.delete(t.route("roles.destroy",b.role.id))}),title:"Delete Role"},{icon:u(()=>[...e[12]||(e[12]=[s("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])]),_:1})):_("",!0)])])]),default:u(()=>[s("div",X,[s("div",Y,[s("form",{class:"space-y-8",onSubmit:F(U,["prevent"])},[s("div",Z,[e[13]||(e[13]=s("div",{class:"flex items-center gap-4 mb-6"},[s("div",{class:"flex h-12 w-12 items-center justify-center rounded-xl bg-primary/10 text-primary"},[s("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})])]),s("div",null,[s("h3",{class:"text-lg font-bold text-gray-900 uppercase tracking-tighter"},"Identity Core"),s("p",{class:"text-xs text-gray-400"},"The primary label used for identifying this role across the system.")])],-1)),s("div",ee,[n(K,{for:"name",value:"Role Designation",class:"text-xs font-black uppercase tracking-widest text-gray-500 mb-2"}),n(L,{id:"name",modelValue:l(r).name,"onUpdate:modelValue":e[1]||(e[1]=o=>l(r).name=o),class:"block w-full border-gray-200 focus:border-primary focus:ring-primary h-12 rounded-xl shadow-soft",placeholder:"e.g., Regional Manager"},null,8,["modelValue"]),n(V,{class:"mt-2",message:l(r).errors.name},null,8,["message"])])]),s("div",se,[s("div",te,[s("div",re,[s("div",oe,[n(y,{id:"global-select-all",checked:S.value,indeterminate:E.value,"onUpdate:checked":N},null,8,["checked","indeterminate"]),e[14]||(e[14]=s("label",{for:"global-select-all",class:"text-xs font-black uppercase tracking-widest text-gray-900 cursor-pointer select-none"}," Global Selector ",-1))]),e[15]||(e[15]=s("div",{class:"h-4 w-px bg-gray-200"},null,-1)),s("div",ie,c(l(r).permission_ids.length)+" / "+c(p.value.length)+" Gates Enabled ",1)]),s("div",le,[e[16]||(e[16]=s("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[s("svg",{class:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),n(L,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=o=>k.value=o),class:"block w-full border-gray-200 pl-10 h-11 rounded-xl text-sm transition-all focus:ring-primary/20 shadow-soft",placeholder:"Search authorization keys..."},null,8,["modelValue"])])]),s("div",ne,[(a(!0),d(v,null,w(G.value,o=>(a(),d("div",{key:o.id,class:"group relative flex flex-col overflow-hidden rounded-2xl border border-gray-100 bg-white shadow-soft transition-all duration-300 hover:border-primary/20 hover:shadow-lg"},[s("div",ae,[s("div",de,[n(y,{id:"group-"+o.id,checked:P(o.matchedPerms),indeterminate:A(o.matchedPerms),"onUpdate:checked":i=>M(o.matchedPerms)},null,8,["id","checked","indeterminate","onUpdate:checked"]),s("h4",ce,c(o.name),1)]),s("span",ue,c(o.matchedPerms.length)+" Keys ",1)]),s("div",me,[(a(!0),d(v,null,w(o.matchedPerms,i=>(a(),d("div",{key:i.id,class:"flex items-center justify-between rounded-xl px-3 py-2.5 transition-all hover:bg-gray-50 group/item"},[s("label",{for:"perm-"+i.id,class:"flex cursor-pointer items-center gap-4 flex-1"},[n(y,{id:"perm-"+i.id,checked:l(r).permission_ids,"onUpdate:checked":e[3]||(e[3]=x=>l(r).permission_ids=x),value:i.id},null,8,["id","checked","value"]),s("div",null,[s("span",ge,c(i.name.split("-").join(" ")),1),s("span",fe,c(i.name),1)])],8,pe),l(r).permission_ids.includes(i.id)?(a(),d("span",he,"Authorized")):_("",!0)]))),128))]),s("div",xe,[s("span",null,c(o.matchedPerms.filter(i=>l(r).permission_ids.includes(i.id)).length)+" / "+c(o.matchedPerms.length)+" ENABLED",1),s("div",ve,[(a(!0),d(v,null,w(o.matchedPerms.length,i=>(a(),d("div",{key:i,class:T(["h-1 w-2 rounded-full",i<=o.matchedPerms.filter(x=>l(r).permission_ids.includes(x.id)).length?"bg-primary":"bg-gray-100"])},null,2))),128))])])]))),128))]),h.value.length>0?(a(),d("div",ye,[s("div",be,[n(y,{id:"group-ungrouped",checked:P(h.value),indeterminate:A(h.value),"onUpdate:checked":e[4]||(e[4]=o=>M(h.value))},null,8,["checked","indeterminate"]),e[17]||(e[17]=s("h4",{class:"text-xs font-black uppercase tracking-[0.3em] text-gray-400"},"Legacy / Uncategorized Gates",-1))]),s("div",ke,[(a(!0),d(v,null,w(h.value,o=>(a(),d("div",{key:o.id,class:"flex items-center justify-between rounded-2xl bg-white border border-gray-100 p-4 transition-all hover:border-primary/30"},[s("label",{for:"perm-un-"+o.id,class:"flex cursor-pointer items-center justify-between w-full"},[s("span",_e,c(o.name),1),n(y,{id:"perm-un-"+o.id,checked:l(r).permission_ids,"onUpdate:checked":e[5]||(e[5]=i=>l(r).permission_ids=i),value:o.id},null,8,["id","checked","value"])],8,we)]))),128))])])):_("",!0),n(V,{class:"mt-2",message:l(r).errors.permission_ids},null,8,["message"])]),s("div",Ce,[s("div",je,[s("span",Me,c(l(r).permission_ids.length),1),e[18]||(e[18]=g(" Permissions Bound ",-1))]),s("div",Pe,[n(C,{type:"button",variant:"secondary",onClick:e[6]||(e[6]=o=>l(r).permission_ids=[])},{default:u(()=>[...e[19]||(e[19]=[g(" Clear All ",-1)])]),_:1}),j("role-edit")?(a(),B(C,{key:0,type:"submit",variant:"primary",processing:l(r).processing,class:"min-w-[160px]"},{icon:u(()=>[...e[20]||(e[20]=[s("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])]),default:u(()=>[e[21]||(e[21]=g(" Apply Changes ",-1))]),_:1},8,["processing"])):_("",!0)])])],32)])])]),_:1})],64))}};export{Ne as default};
