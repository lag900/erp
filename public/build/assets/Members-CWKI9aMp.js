import{u as M,o as l,c as n,a as d,b as f,h as U,w as m,d as s,j as $,i as h,k as S,F as x,m as b,n as j,t as c,f as q,g as D,l as F,r as L,p as y,q as N}from"./app-CehYguHu.js";import{_ as P}from"./AuthenticatedLayout-CfY1nA_Q.js";import{_ as A}from"./TextInput-CVQfVas4.js";import{P as G}from"./PrimaryButton-BWR49dfZ.js";import{_ as O}from"./InputLabel-BdAlJ2D5.js";import{G as v}from"./GlobalCheckbox-CqgO5sP7.js";/* empty css                                                              */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DangerButton-DmNu9a4c.js";import"./SecondaryButton-C9gXAhlZ.js";const R={class:"flex flex-wrap items-center justify-between gap-3"},z={class:"text-xl font-semibold leading-tight text-gray-800"},E={class:"py-6"},I={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},T={class:"mb-4 flex flex-wrap items-center justify-between gap-3"},H={class:"overflow-hidden rounded bg-white shadow"},J={class:"min-w-full divide-y divide-gray-200 text-sm"},K={class:"divide-y divide-gray-200"},Q={class:"px-4 py-3"},W={class:"flex items-center gap-3"},X={class:"text-gray-800"},Y={class:"text-xs text-gray-500"},Z={class:"px-4 py-3"},ee={class:"max-w-xs"},se=["id","onUpdate:modelValue","disabled"],te=["value"],re={class:"px-4 py-3"},ae={class:"flex items-center gap-2 text-sm text-gray-600"},fe={__name:"Members",props:{department:{type:Object,required:!0},users:{type:Array,required:!0},roles:{type:Array,required:!0},memberships:{type:Object,required:!0}},setup(u){const o=u,p=L(""),w=N(),k=y(()=>w.props.auth?.permissions??[]),g=r=>k.value.includes(r),i=M({members:o.users.map(r=>{const e=o.memberships[r.id];return{user_id:r.id,is_member:!!e,role_id:e?.role_id??o.roles[0]?.id??null,is_default:e?.is_default??!1}})}),_=y(()=>o.users.reduce((r,e)=>(r[e.id]=e,r),{})),V=y(()=>{const r=p.value.trim().toLowerCase();return r?i.members.filter(e=>{const t=_.value[e.user_id];return t?t.name.toLowerCase().includes(r)||t.email.toLowerCase().includes(r):!1}):i.members}),B=r=>{r.is_member=!r.is_member,r.is_member||(r.is_default=!1)},C=()=>{const r=i.members.filter(e=>e.is_member).map(e=>({user_id:e.user_id,role_id:e.role_id,is_default:e.is_default}));i.transform(()=>({members:r})).put(route("departments.members.update",o.department.id),{preserveScroll:!0,onFinish:()=>i.transform(e=>e)})};return(r,e)=>(l(),n(x,null,[d(f(U),{title:`Members - ${u.department.name}`},null,8,["title"]),d(P,null,{header:m(()=>[s("div",R,[s("h2",z," Members - "+c(u.department.name),1),d(f(F),{href:r.route("departments.index"),class:"rounded border border-gray-300 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50"},{default:m(()=>[...e[1]||(e[1]=[h(" Back to Departments ",-1)])]),_:1},8,["href"])])]),default:m(()=>[s("div",E,[s("div",I,[s("div",T,[d(A,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),type:"text",class:"mt-1 block w-full sm:max-w-sm",placeholder:"Search users..."},null,8,["modelValue"]),g("department-assign-users")?(l(),$(G,{key:0,disabled:f(i).processing,onClick:C},{default:m(()=>[...e[2]||(e[2]=[h(" Save Members ",-1)])]),_:1},8,["disabled"])):S("",!0)]),s("div",H,[s("table",J,[e[5]||(e[5]=s("thead",{class:"bg-gray-50 text-left text-gray-600"},[s("tr",null,[s("th",{class:"px-4 py-3 font-medium"},"Member"),s("th",{class:"px-4 py-3 font-medium"},"Role"),s("th",{class:"px-4 py-3 font-medium"},"Default")])],-1)),s("tbody",K,[(l(!0),n(x,null,b(V.value,t=>(l(),n("tr",{key:t.user_id,class:j(t.is_member?"bg-white":"bg-gray-50")},[s("td",Q,[s("div",W,[d(v,{checked:t.is_member,id:"member-"+t.user_id,"onUpdate:checked":a=>B(t)},null,8,["checked","id","onUpdate:checked"]),s("div",null,[s("p",X,c(_.value[t.user_id]?.name),1),s("p",Y,c(_.value[t.user_id]?.email),1)])])]),s("td",Z,[s("div",ee,[d(O,{for:`role-${t.user_id}`,value:"Role",class:"sr-only"},null,8,["for"]),q(s("select",{id:`role-${t.user_id}`,"onUpdate:modelValue":a=>t.role_id=a,disabled:!t.is_member||!g("department-assign-users"),class:"w-full rounded border-gray-300 text-sm shadow-sm focus:border-indigo-500 focus:ring-indigo-500 disabled:bg-gray-100"},[e[3]||(e[3]=s("option",{value:"",disabled:""},"Select role",-1)),(l(!0),n(x,null,b(u.roles,a=>(l(),n("option",{key:a.id,value:a.id},c(a.name),9,te))),128))],8,se),[[D,t.role_id]])])]),s("td",re,[s("label",ae,[d(v,{checked:t.is_default,"onUpdate:checked":a=>t.is_default=a,id:"default-"+t.user_id},null,8,["checked","onUpdate:checked","id"]),e[4]||(e[4]=h(" Default for this user ",-1))])])],2))),128))])])])])])]),_:1})],64))}};export{fe as default};
